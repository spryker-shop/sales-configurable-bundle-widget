{% extends template('widget') %}

{% define data = {
    items: _widget.items,
    salesOrderConfiguredBundles: _widget.salesOrderConfiguredBundles,
    currencyIsoCode: _widget.order.currencyIsoCode,
} %}

{% block body %}
    {% for bundle in data.salesOrderConfiguredBundles %}
        {% block bundleItem %}
            {% embed molecule('configured-bundle', 'ConfigurableBundleWidget') ignore missing with {
                class: 'spacing-bottom spacing-bottom--big',
                modifiers: ['ordered'],
                data: {
                    bundle: bundle,
                    items: data.items,
                    currencyIsoCode: data.currencyIsoCode,
                },
            } only %}
                {%- block extraClass -%}{%- endblock -%}
                {%- block bundleNameText -%}{{ data.bundle.name | trans }}{%- endblock -%}

                {%- block bundleTotalValue -%}
                    {% set bundleSumPriceToPayAggregation = 0 %}

                    {% for item in data.bundle.salesOrderConfiguredBundleItems if data.items[item.IdSalesOrderItem] is defined %}
                        {% set product = data.items[item.IdSalesOrderItem] %}
                        {% set bundleSumPriceToPayAggregation = bundleSumPriceToPayAggregation + product.sumPriceToPayAggregation %}
                    {% endfor %}

                    {{ bundleSumPriceToPayAggregation | money(true, data.currencyIsoCode) }}
                {%- endblock -%}

                {% block bundleProductListInner %}
                    {% for item in data.bundle.salesOrderConfiguredBundleItems if data.items[item.IdSalesOrderItem] is defined %}
                        {% embed molecule('configured-bundle-product', 'ConfigurableBundleWidget') ignore missing with {
                            data: {
                                product: data.items[item.IdSalesOrderItem],
                                currencyIsoCode: data.currencyIsoCode,
                                image: data.items[item.IdSalesOrderItem].metadata.image,
                            },
                        } only %}
                            {% block imageContainer %}
                                <div class="{{ config.name }}__col {{ config.name }}__col--container col col--sm-12 col--lg-2">
                                    <div class="grid grid--middle">
                                        <div class="{{ config.name }}__col-inner">
                                            {% widget 'CustomerReorderItemCheckboxWidget' args [data.product] only %}{% endwidget %}
                                        </div>
                                    </div>
                                    <div class="{{ config.name }}__image-container grid grid--middle">
                                        {% block image %}
                                            {% set imageModifiers =  ['small', 'full-width'] %}

                                            {{ parent() }}
                                        {% endblock %}
                                    </div>
                                </div>
                            {% endblock %}
                        {% endembed %}
                    {% endfor %}
                {% endblock %}

                {% block bundleActions %}{% endblock %}
            {% endembed %}
        {% endblock %}
    {% endfor %}
{% endblock %}
